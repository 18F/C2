dependencies:
  override:
    - |
      if [[ -e ~/rvm_binaries/ruby-2.3.1.tar.bz2 ]]
      then
        rvm mount ~/rvm_binaries/ruby-2.3.1.tar.bz2
      else
        mkdir ~/rvm_binaries || true
        rvm install 2.3.1
        gem update --system
        gem install bundler
        cd ~/rvm_binaries && rvm prepare 2.3.1
        ls ~/rvm_binaries
      fi
    - rvm --default use 2.3.1
  pre:
    - bundle install --without development test
    - bash ./build-elasticsearch.sh
    - sudo curl --output /usr/local/bin/phantomjs https://s3.amazonaws.com/circle-downloads/phantomjs-2.1.1
  cache_directories:
    - elasticsearch
    - ~/rvm_binaries
test:
  override:
    - gem list
    - ruby --version
    - bundle exec rspec -r rspec_junit_formatter --format RspecJunitFormatter -o $CIRCLE_TEST_REPORTS/rspec/junit.xml --tag '~js' --require rails_helper:
        parallel: true
        files:
          - spec/**/*_spec.rb
